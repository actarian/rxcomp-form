/**
 * @license rxcomp-form v1.0.0-alpha.7
 * (c) 2019 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(require("rxcomp"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("main",["rxcomp","rxjs","rxjs/operators"],n):n((t=t||self).rxcomp,t.rxjs,t.rxjs.operators)}(this,(function(t,n,e){"use strict";function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}function o(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}var s="valid",u="invalid",a="pending",c="disabled",h=["untouched","touched","pristine","dirty","pending","enabled","disabled","valid","invalid"],l=function(n){function e(){return n.apply(this,arguments)||this}return o(e,n),e.prototype.onChanges=function(n){var e=t.getContext(this).node,i=this.control;h.forEach((function(t){i[t]?e.classList.add(t):e.classList.remove(t)}))},r(e,[{key:"control",get:function(){if(this.controlGroup)return this.controlGroup;var n=t.getContext(this).parentInstance;if(!n.form)throw"missing form";return n.form.get(this.controlGroupName)}}]),e}(t.Component);l.meta={selector:"[[controlGroup]],[[controlGroupName]],[controlGroupName]",inputs:["controlGroup","controlGroupName"]};var f=function(n){function e(){return n.apply(this,arguments)||this}o(e,n);var i=e.prototype;return i.onInit=function(){var n=t.getContext(this).node;this.node=n,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),n.addEventListener("input",this.onChange),n.addEventListener("change",this.onChange),n.addEventListener("blur",this.onBlur)},i.onChanges=function(n){var e=t.getContext(this).node,i=this.control;h.forEach((function(t){i[t]?e.classList.add(t):e.classList.remove(t)})),this.writeValue(i.value)},i.writeValue=function(n){t.getContext(this).node.value=null==n?"":n},i.setDisabledState=function(n){t.getContext(this).node.disabled=n},i.onChange=function(n){var e=t.getContext(this).node;this.control.value=e.value},i.onFocus=function(t){},i.onBlur=function(t){this.control.touched=!0},i.getPre=function(t){var n=t.previousSibling;return n&&3===n.nodeType||(n=document.createTextNode(""),t.parentNode.insertBefore(n,t)),n},r(e,[{key:"control",get:function(){if(this.formControl)return this.formControl;var n=t.getContext(this).parentInstance;if(!n.form)throw"missing form";return n.form.get(this.formControlName)}}]),e}(t.Directive);f.meta={selector:"input,textarea,select",inputs:["formControl","formControlName"]};var d=function(n){function e(){return n.apply(this,arguments)||this}return o(e,n),e.prototype.onChanges=function(n){var e=t.getContext(this).node,i=this.form;h.forEach((function(t){i[t]?e.classList.add(t):e.classList.remove(t)}))},r(e,[{key:"form",get:function(){if(this.formGroup)return this.formGroup;var n=t.getContext(this).parentInstance;if(!n.form)throw"missing form";return n.form.get(this.formGroupName)}}]),e}(t.Component);d.meta={selector:"[[formGroup]],[[formGroupName]],[formGroupName]",inputs:["formGroup","formGroupName"]};var p=function(i){function r(){return i.apply(this,arguments)||this}return o(r,i),r.prototype.onInit=function(){var i=t.getContext(this),r=i.module,o=i.node,s=i.selector,u=i.parentInstance,a=this.event=s.replace(/\[|\]|\(|\)/g,""),c=this.event$=n.fromEvent(o,a).pipe(e.tap((function(t){t.preventDefault()})),e.shareReplay(1)),h=o.getAttribute("("+a+")");if(h){var l=r.makeFunction(h,["$event"]);c.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(l,u,t)}))}else u[a+"$"]=c},r}(t.Directive);p.meta={selector:"[("+["submit"].join(")],[(")+")]"};var v=function(t){function n(){return t.apply(this,arguments)||this}return o(n,t),n}(t.Module),m=[f,d,l,p],b=[];v.meta={declarations:[].concat(m,b),exports:[].concat(m,b)};var g=function(){function t(t){void 0===t&&(t=[]),this.validators=t,this.errors=[]}var i=t.prototype;return i.initSubjects_=function(){this.valueSubject=new n.BehaviorSubject(null),this.valueChildren=new n.Subject,this.statusSubject=new n.BehaviorSubject(this),this.statusChildren=new n.Subject},i.initObservables_=function(){var t=this;this.value$=n.merge(this.valueSubject,this.valueChildren).pipe(e.distinctUntilChanged(),e.skip(1),e.tap((function(n){t.dirty_=!0,t.statusSubject.next(t)})),e.shareReplay(1)),this.status$=n.merge(this.statusSubject,this.statusChildren).pipe(e.tap((function(n){t.reduceValidators_()})),e.shareReplay(1))},i.reduceValidators_=function(){return this.validate(this.value)},i.validate=function(t){return this.status===c?this.errors=[]:(this.errors=this.validators.map((function(n){return n(t)})).filter((function(t){return null!==t})),this.status=0===this.errors.length?s:u),this.errors},i.reset=function(){this.value_=null,this.dirty_=!1,this.touched_=!1,this.statusSubject.next(this)},i.patch=function(t){this.value_=t,this.dirty_=!0,this.statusSubject.next(this)},r(t,[{key:"valid",get:function(){return this.status===s}},{key:"invalid",get:function(){return this.status===u}},{key:"pending",get:function(){return this.status===a}},{key:"disabled",get:function(){return this.status===c}},{key:"enabled",get:function(){return this.status!==c}},{key:"dirty",get:function(){return this.dirty_}},{key:"pristine",get:function(){return!this.dirty_}},{key:"touched",get:function(){return this.touched_},set:function(t){this.touched_=t,this.statusSubject.next(this)}},{key:"untouched",get:function(){return!this.touched_}},{key:"value",get:function(){return this.value_},set:function(t){this.value_=t,this.valueSubject.next(t)}}]),t}(),y=function(t){function n(n,e){var i;return void 0===n&&(n=null),(i=t.call(this,e)||this).value_=n,i.initSubjects_(),i.initObservables_(),i.statusSubject.next(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}return o(n,t),n}(g),_=function(t){function i(n,e){var i;return(i=t.call(this,e)||this).controls=n,i.initControls_(n),i.initSubjects_(),i.initObservables_(),i}o(i,t);var a=i.prototype;return a.initControl_=function(t){return t instanceof g?t:new y(t,this.validators)},a.initControls_=function(t){var n=this;return this.forEach_((function(t,e){n.set(n.initControl_(t),e)})),t},a.initSubjects_=function(){var t=this;this.valueSubject=new n.BehaviorSubject(null);var i=this.reduce_((function(t,n){return t.push(n.value$),t}),[]);this.valueChildren=n.combineLatest(i).pipe(e.map((function(n){return t.value})),e.shareReplay(1)),this.statusSubject=new n.BehaviorSubject(this);var r=this.reduce_((function(t,n){return t.push(n.status$),t}),[]);this.statusChildren=n.combineLatest(r).pipe(e.shareReplay(1))},a.initObservables_=function(){var t=this;this.value$=n.merge(this.valueSubject,this.valueChildren).pipe(e.distinctUntilChanged(),e.skip(1),e.tap((function(n){t.dirty_=!0,t.statusSubject.next(t)})),e.shareReplay(1)),this.status$=n.merge(this.statusSubject,this.statusChildren).pipe(e.tap((function(n){t.reduceValidators_()})),e.shareReplay(1))},a.validate=function(t){if(this.status===c)this.errors=[];else{var n=this.validators.map((function(n){return n(t)})).filter((function(t){return null!==t}));this.errors=this.reduce_((function(t,n){return t.concat(n.errors)}),n),this.status=0===this.errors.length?s:u}return this.errors},a.forEach_=function(t){var n=this;Object.keys(this.controls).forEach((function(e){return t(n.controls[e],e)}))},a.reduce_=function(t,n){return this.forEach_((function(e,i){n=t(n,e,i)})),n},a.all_=function(t,n){return this.reduce_((function(e,i){return e&&i[t]===n}),!0)},a.any_=function(t,n){return this.reduce_((function(e,i){return e||i[t]===n}),!1)},a.reset=function(){this.forEach_((function(t){return t.reset()}))},a.patch=function(t){this.forEach_((function(n,e){return n.patch(t[e])}))},a.get=function(t){return this.controls[t]},a.set=function(t,n){this.controls[n],delete this.controls[n],t&&(this.controls[n]=t)},a.add=function(t,n){t&&(this.controls[n]=t)},a.remove=function(t){this.controls[t],delete this.controls[t]},r(i,[{key:"valid",get:function(){return this.all_("valid",!0)}},{key:"invalid",get:function(){return this.any_("invalid",!0)}},{key:"pending",get:function(){return this.any_("pending",!0)}},{key:"disabled",get:function(){return this.all_("disabled",!0)}},{key:"enabled",get:function(){return this.any_("enabled",!0)}},{key:"dirty",get:function(){return this.any_("dirty",!0)}},{key:"pristine",get:function(){return this.all_("pristine",!0)}},{key:"touched",get:function(){return this.all_("touched",!0)},set:function(t){this.forEach_((function(n){n.touched=t})),this.statusSubject.next(this)}},{key:"untouched",get:function(){return this.any_("untouched",!0)}},{key:"value",get:function(){return this.reduce_((function(t,n,e){return t[e]=n.value,t}),{})},set:function(t){}}]),i}(g),C=function(t){function n(n,e){return void 0===n&&(n=[]),t.call(this,n,e)||this}o(n,t);var e=n.prototype;return e.forEach_=function(t){this.controls.forEach((function(n,e){return t(n,e)}))},e.set=function(t,n){this.controls.length=Math.max(this.controls.length,n),this.controls[n]=t},r(n,[{key:"value",get:function(){return this.reduce_((function(t,n,e){return t[e]=n.value,t}),[])}}]),n}(_),j=function(t){function n(n,e){return void 0===n&&(n={}),t.call(this,n,e)||this}return o(n,t),n}(_);function x(t){return null==t||0===t.length?"required":null}var k=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var e=n.prototype;return e.onInit=function(){var t=this,n=new j({firstName:null,lastName:null,email:null,country:1,items:new C([null,null,null])},[x]);n.value$.subscribe((function(t){})),n.status$.subscribe((function(){t.pushChanges()})),this.form=n},e.onValidate=function(){return this.form.valid},e.onSubmit=function(){console.log("AppComponent.onSubmit",this.form.value)},n}(t.Component);k.meta={selector:"[app-component]"};var S=function(t){function n(){return t.apply(this,arguments)||this}return o(n,t),n}(t.Module);S.meta={imports:[t.CoreModule,v],declarations:[],bootstrap:k},t.Browser.bootstrap(S)}));
//# sourceMappingURL=main.min.js.map