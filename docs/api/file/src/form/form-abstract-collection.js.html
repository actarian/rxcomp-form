<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/form/form-abstract-collection.js | RxComp FormModule</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="RxComp FormModule is a Reactive Form Module for RxComp library."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="RxComp FormModule"><meta property="twitter:description" content="RxComp FormModule is a Reactive Form Module for RxComp library."><link rel="stylesheet" href="assets/esdoc/css/esdoc.css">

	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-WL42JM2');</script>
	<!-- End Google Tag Manager -->
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WL42JM2"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	  </head>
<body class="layout-container" data-ice="rootContainer">
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WL42JM2"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/actarian/rxcomp-form"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form.module.js~FormModule.html">FormModule</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#form">form</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/form-abstract-collection.js~FormAbstractCollection.html">FormAbstractCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/form-abstract.js~FormAbstract.html">FormAbstract</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/form-array.js~FormArray.html">FormArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/form-control.js~FormControl.html">FormControl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/form-group.js~FormGroup.html">FormGroup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formArray">formArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formControl">formControl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formGroup">formGroup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#form-directives">form/directives</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-abstract-collection.directive.js~FormAbstractCollectionDirective.html">FormAbstractCollectionDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-abstract.directive.js~FormAbstractDirective.html">FormAbstractDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-array.directive.js~FormArrayDirective.html">FormArrayDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-checkbox.directive.js~FormCheckboxDirective.html">FormCheckboxDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-field.component.js~FormFieldComponent.html">FormFieldComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-group.directive.js~FormGroupDirective.html">FormGroupDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-input.directive.js~FormInputDirective.html">FormInputDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-placeholder.directive.js~FormPlaceholderDirective.html">FormPlaceholderDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-radio.directive.js~FormRadioDirective.html">FormRadioDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-select.directive.js~FormSelectDirective.html">FormSelectDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/directives/form-submit.directive.js~FormSubmitDirective.html">FormSubmitDirective</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#form-validators">form/validators</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-email.directive.js~FormEmailDirective.html">FormEmailDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-max-length.directive.js~FormMaxLengthDirective.html">FormMaxLengthDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-max.directive.js~FormMaxDirective.html">FormMaxDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-min-length.directive.js~FormMinLengthDirective.html">FormMinLengthDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-min.directive.js~FormMinDirective.html">FormMinDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-pattern.directive.js~FormPatternDirective.html">FormPatternDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-required-true.directive.js~FormRequiredTrueDirective.html">FormRequiredTrueDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-required.directive.js~FormRequiredDirective.html">FormRequiredDirective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/form/validators/form-validator.js~FormValidator.html">FormValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-EmailValidator">EmailValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MaxLengthValidator">MaxLengthValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MaxValidator">MaxValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MinLengthValidator">MinLengthValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MinValidator">MinValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NullValidator">NullValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PatternValidator">PatternValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-RequiredTrueValidator">RequiredTrueValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-RequiredValidator">RequiredValidator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/form/form-abstract-collection.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { BehaviorSubject, combineLatest, of } from &apos;rxjs&apos;;
import { map, shareReplay, switchAll } from &apos;rxjs/operators&apos;;
import FormAbstract from &apos;./form-abstract&apos;;
import FormControl from &apos;./form-control&apos;;
import FormStatus from &apos;./models/form-status&apos;;

/**
 * @desc Abstract class representing a form collection.
 * @abstract
 * @access public
 */
export default class FormAbstractCollection extends FormAbstract {
	/**
	 * Create a FormAbstract.
	 * @param {Map&lt;string, any|FormAbstract&gt;} controls - An object containing controls.
	 * @param {FormValidator[]} validators - A list of validators.
	 */
	constructor(controls, validators) {
		super(validators);
		this.controls = controls;
		this.initControls_(controls);
		this.initSubjects_();
		this.initObservables_();
	}

	/**
	 * @private
	 */
	initControl_(control, key) {
		control = control instanceof FormAbstract ? control : new FormControl(control);
		control.addValidators(...this.validators);
		control.name = key;
		return control;
	}

	/**
	 * @private
	 */
	initControls_(controls) {
		this.forEach_((control, key) =&gt; {
			this.init(control, key);
		});
		return controls;
	}

	/**
	 * @private
	 */
	initSubjects_() {
		this.changesChildren = new BehaviorSubject().pipe(
			switchAll()
		);
		this.switchSubjects_();
	}

	/**
	 * @private
	 */
	switchSubjects_() {
		const changesChildren = this.reduce_((result, control) =&gt; {
			result.push(control.changes$);
			return result;
		}, []);
		let changesChildren$ = changesChildren.length ? combineLatest(changesChildren) : of (changesChildren);
		this.changesChildren.next(changesChildren$);
	}

	/**
	 * @private
	 */
	initObservables_() {
		this.changes$ = this.changesChildren.pipe(
			map(() =&gt; this.value),
			shareReplay(1)
		);
	}

	validate(value) {
		if (this.status === FormStatus.Disabled || this.status === FormStatus.Hidden) {
			// this.errors = {};
			this.errors = [];
		} else {
			// this.errors = Object.assign({}, ...this.validators.map(x =&gt; x(value)));
			// this.status = Object.keys(this.errors).length === 0 ? FormStatus.Valid : FormStatus.Invalid;
			let errors = this.validators.map(x =&gt; x(value)).filter(x =&gt; x !== null);
			this.errors = this.reduce_((result, control) =&gt; {
				return result.concat(control.errors);
			}, errors);
			this.status = this.errors.length === 0 ? FormStatus.Valid : FormStatus.Invalid;
		}
		return this.errors;
	}

	/**
	 * @private
	 */
	forEach_(callback) {
		Object.keys(this.controls).forEach(key =&gt; callback(this.controls[key], key));
	}

	/**
	 * @private
	 */
	reduce_(callback, result) {
		this.forEach_((control, key) =&gt; {
			result = callback(result, control, key);
		});
		return result;
	}

	/**
	 * @private
	 */
	all_(key, value) {
		return this.reduce_((result, control) =&gt; {
			return result &amp;&amp; control[key] === value;
		}, true);
	}

	/**
	 * @private
	 */
	any_(key, value) {
		return this.reduce_((result, control) =&gt; {
			return result || control[key] === value;
		}, false);
	}

	get valid() { return this.all_(&apos;valid&apos;, true); }
	get invalid() { return this.any_(&apos;invalid&apos;, true); }
	get pending() { return this.any_(&apos;pending&apos;, true); }
	get disabled() { return this.all_(&apos;disabled&apos;, true); }
	get enabled() { return this.any_(&apos;enabled&apos;, true); }
	get hidden() { return this.all_(&apos;hidden&apos;, true); }
	get visible() { return this.any_(&apos;visible&apos;, true); }
	get submitted() { return this.all_(&apos;submitted&apos;, true); }
	get dirty() { return this.any_(&apos;dirty&apos;, true); }
	get pristine() { return this.all_(&apos;pristine&apos;, true); }
	get touched() { return this.all_(&apos;touched&apos;, true); }
	get untouched() { return this.any_(&apos;untouched&apos;, true); }

	set disabled(disabled) {
		this.forEach_(control =&gt; {
			control.disabled = disabled;
		});
	}

	set hidden(hidden) {
		this.forEach_(control =&gt; {
			control.hidden = hidden;
		});
	}

	set submitted(submitted) {
		this.forEach_(control =&gt; {
			control.submitted = submitted;
		});
	}

	set touched(touched) {
		this.forEach_(control =&gt; {
			control.touched = touched;
		});
	}

	get value() {
		return this.reduce_((result, control, key) =&gt; {
			result[key] = control.value;
			return result;
		}, {});
	}

	set value(value) {
		this.forEach_((control, key) =&gt; {
			control.value = value[key];
		});
	}

	get errors() {
		return this.reduce_((result, control) =&gt; {
			return Object.assign(result, control.errors);
		}, {});
	}

	reset() {
		this.forEach_(control =&gt; control.reset());
	}

	patch(value) {
		if (value) {
			this.forEach_((control, key) =&gt; {
				if (value[key] != undefined) { // !!! keep != loose inequality
					control.patch(value[key]);
				}
			});
		}
	}

	init(control, key) {
		this.controls[key] = this.initControl_(control, key);
	}

	get(key) {
		return this.controls[key];
	}

	set(control, key) {
		delete(this.controls[key]);
		this.controls[key] = this.initControl_(control, key);
		this.switchSubjects_();
	}

	// !!! needed?
	add(control, key) {
		this.controls[key] = this.initControl_(control, key);
		this.switchSubjects_();
	}

	remove(control) {
		const key = Object.keys(this.controls).find(key =&gt; this.controls[key] === control ? key : null);
		if (key) {
			this.removeKey(key);
		}
	}

	removeKey(key) {
		const changed = this.controls[key] !== undefined;
		delete(this.controls[key]);
		if (changed) {
			this.switchSubjects_();
		}
	}

	/**
	 * adds one or more FormValidator.
	 * @param {...FormValidator[]} validators - A list of validators.
	 */
	addValidators(...validators) {
		this.forEach_(control =&gt; control.addValidators(...validators));
	}

	/**
	 * replace one or more FormValidator.
	 * @param {...FormValidator[]} validators - A list of validators.
	 */
	replaceValidators(...validators) {
		this.forEach_(control =&gt; control.replaceValidators(...validators));
	}

	/**
	 * remove all FormValidator.
	 */
	clearValidators() {
		this.forEach_(control =&gt; control.clearValidators());
	}

}
</code></pre>

</div>



<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
