/**
 * @license rxcomp-form v1.0.0-beta.2
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("rxcomp"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("rxcomp-form",["exports","rxcomp","rxjs","rxjs/operators"],n):n((t=t||self)["rxcomp-form"]={},t.rxcomp,t.rxjs,t.rxjs.operators)}(this,(function(t,n,e,i){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}function s(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}var a={Pending:"pending",Valid:"valid",Invalid:"invalid",Disabled:"disabled",Hidden:"hidden"},u=["untouched","touched","pristine","dirty","pending","enabled","disabled","hidden","visible","valid","invalid","submitted"],h=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.onChanges=function(t){var e=n.getContext(this).node,i=this.control;u.forEach((function(t){i[t]?e.classList.add(t):e.classList.remove(t)}))},o(e,[{key:"control",get:function(){return{}}}]),e}(n.Directive);h.meta={hosts:{host:h}};var l=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),o(n,[{key:"control",get:function(){if(this.formArray)return this.formArray;if(!this.host)throw"missing form collection";return this.host.control.get(this.formArrayName)}}]),n}(h);l.meta={selector:"[formArray],[formArrayName]",inputs:["formArray","formArrayName"],hosts:{host:h}};var c=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.onInit=function(){var t=n.getContext(this).node;this.node=t,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),t.addEventListener("input",this.onChange),t.addEventListener("change",this.onChange),t.addEventListener("blur",this.onBlur)},i.onChanges=function(t){var e=n.getContext(this).node;this.formControlName&&(e.name=this.formControlName);var i=this.control;u.forEach((function(t){i[t]?e.classList.add(t):e.classList.remove(t)})),this.writeValue(i.value)},i.writeValue=function(t){n.getContext(this).node.value=null==t?"":t},i.onChange=function(t){var e=n.getContext(this).node;this.control.value=""===e.value?null:e.value},i.onBlur=function(t){this.control.touched=!0},i.setDisabledState=function(t){n.getContext(this).node.disabled=t},o(e,[{key:"control",get:function(){if(this.formControl)return this.formControl;if(!this.host)throw"missing form collection";return this.host.control.get(this.formControlName)}}]),e}(n.Directive);c.meta={inputs:["formControl","formControlName","value"],hosts:{host:h}};var f=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.onInit=function(){var t=n.getContext(this).node;this.node=t,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),t.addEventListener("input",this.onChange),t.addEventListener("blur",this.onBlur)},i.writeValue=function(t){var e=n.getContext(this).node;t===this.value?e.setAttribute("checked",t):e.removeAttribute("checked")},i.setDisabledState=function(t){n.getContext(this).node.disabled=t},i.onChange=function(t){var e=n.getContext(this).node;this.control.value=e.checked?this.value:!0!==this.value&&null},i.onBlur=function(t){this.control.touched=!0},e}(c);f.meta={selector:"input[type=checkbox][formControl],input[type=checkbox][formControlName]",inputs:["formControl","formControlName","value"],hosts:{host:h}};var d=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.onChanges=function(t){var e=n.getContext(this).node,i=this.control;u.forEach((function(t){i[t]?e.classList.add(t):e.classList.remove(t)}))},o(e,[{key:"control",get:function(){if(this.formField)return this.formField;if(!this.host)throw"missing form collection";return this.host.control.get(this.formFieldName)}}]),e}(n.Component);d.meta={selector:"[formField],[formFieldName]",inputs:["formField","formFieldName"],hosts:{host:h}};var m=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),o(n,[{key:"control",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control.get(this.formGroupName)}}]),n}(h);m.meta={selector:"[formGroup],[formGroupName]",inputs:["formGroup","formGroupName"],hosts:{host:h}};var p=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.writeValue=function(t){n.getContext(this).node.value=null==t?"":t},i.onChange=function(t){var e=n.getContext(this).node;this.control.value=""===e.value?null:e.value},i.onBlur=function(t){this.control.touched=!0},e}(c);p.meta={selector:"input[type=text][formControl],input[type=text][formControlName],input[type=email][formControl],input[type=email][formControlName],input[type=password][formControl],input[type=password][formControlName],textarea[formControl],textarea[formControlName]",inputs:["formControl","formControlName"],hosts:{host:h}};var v=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.onChanges=function(t){n.getContext(this).node.placeholder=this.placeholder},e}(n.Directive);v.meta={selector:"input[placeholder],textarea[placeholder]",inputs:["placeholder"]};var g=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.onInit=function(){var t=n.getContext(this).node;this.node=t,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),t.addEventListener("input",this.onChange),t.addEventListener("blur",this.onBlur)},i.writeValue=function(t){var e=n.getContext(this).node;e.checked=e.value===t},i.setDisabledState=function(t){n.getContext(this).node.disabled=t},i.onChange=function(t){var e=n.getContext(this).node;e.checked&&(this.control.value=e.value)},i.onBlur=function(t){this.control.touched=!0},e}(c);g.meta={selector:"input[type=radio][formControl],input[type=radio][formControlName]",inputs:["formControl","formControlName"],hosts:{host:h}};var y=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.writeValue=function(t){n.getContext(this).node.value=null==t?"":t},i.setDisabledState=function(t){n.getContext(this).node.disabled=t},i.onChange=function(t){var e=n.getContext(this).node;this.control.value=""===e.value?null:e.value},i.onBlur=function(t){this.control.touched=!0},e}(c);y.meta={selector:"select[formControl],select[formControlName]",inputs:["formControl","formControlName"],hosts:{host:h}};var b=function(t){function r(){return t.apply(this,arguments)||this}return s(r,t),r.prototype.onInit=function(){var t=n.getContext(this),r=t.module,o=t.node,s=t.selector,a=t.parentInstance,u=this.event=s.replace(/\[|\]|\(|\)/g,""),h=this.event$=e.fromEvent(o,u).pipe(i.tap((function(t){t.preventDefault()})),i.shareReplay(1)),l=o.getAttribute("("+u+")");if(l){var c=r.makeFunction(l,["$event"]);h.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(c,a,t)}))}else a[u+"$"]=h},r}(n.Directive);b.meta={selector:"[(submit)]"};var C=function(){function t(t,n){this.validator=t.bind(this),this.params$=new e.BehaviorSubject(n)}return o(t,[{key:"params",get:function(){return this.params$.getValue()},set:function(t){if(t){var n=this.params;Object.keys(t).reduce((function(e,i){return e||!n||n[i]!==t[i]}),!1)&&this.params$.next(t)}}}]),t.prototype.validate=function(t){return this.validator(t)},t}();function _(){return new C((function(t){return null}))}function x(){return new C((function(t){return null==t||0===t.length?{required:!0}:null}))}function V(){return new C((function(t){return!0===t?null:{required:!0}}))}function w(t){return new C((function(t){var n=this.params.min;return t&&n?(t=parseFloat(t),!isNaN(t)&&t<n?{min:{min:n,actual:t}}:null):null}),{min:t})}function j(t){return new C((function(t){var n=this.params.max;return t&&n?(t=parseFloat(t),!isNaN(t)&&t>n?{max:{max:n,actual:t}}:null):null}),{max:t})}function k(t){return new C((function(t){var n=this.params.minlength;if(!t||!n)return null;var e=t?t.length:0;return e<n?{minlength:{requiredLength:n,actualLength:e}}:null}),{minlength:t})}function S(t){return new C((function(t){var n=this.params.maxlength;if(!t||!n)return null;var e=t?t.length:0;return e>n?{minlength:{requiredLength:n,actualLength:e}}:null}),{maxlength:t})}function D(t){return new C((function(t){var n=this.params.pattern;if(!t||!n)return null;var e=function(t){var n;t instanceof RegExp?n=t:"string"==typeof t&&(t="$"===(t="^"===t.charAt(0)?t:"^"+t).charAt(t.length-1)?t:t+"$",n=new RegExp(t));return n}(n);return e.test(t)?null:{pattern:{requiredPattern:e.toString(),actualValue:t}}}),{pattern:t})}function N(t){var n=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return new C((function(t){return t?n.test(t)?null:{email:!0}:null}))}var F=Object.freeze({__proto__:null,NullValidator:_,RequiredValidator:x,RequiredTrueValidator:V,MinValidator:w,MaxValidator:j,MinLengthValidator:k,MaxLengthValidator:S,PatternValidator:D,EmailValidator:N}),A=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n.prototype.onInit=function(){var t=this.validator=N();this.host.control.addValidators(t)},n}(n.Directive);A.meta={selector:"[email][formControl],[email][formControlName]",inputs:["email"],hosts:{host:c}};var E=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var e=n.prototype;return e.onInit=function(){this.validator=S(this.maxlength);this.host.control.addValidators(this.validator)},e.onChanges=function(t){this.validator.params={maxlength:this.maxlength}},n}(n.Directive);E.meta={selector:"[maxlength][formControl],[maxlength][formControlName]",inputs:["maxlength"],hosts:{host:c}};var L=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var e=n.prototype;return e.onInit=function(){this.validator=j(this.max);this.host.control.addValidators(this.validator)},e.onChanges=function(t){this.validator.params={max:this.max}},n}(n.Directive);L.meta={selector:"[max][formControl],[max][formControlName]",inputs:["max"],hosts:{host:c}};var $=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var e=n.prototype;return e.onInit=function(){this.validator=k(this.minlength);this.host.control.addValidators(this.validator)},e.onChanges=function(t){this.validator.params={minlength:this.minlength}},n}(n.Directive);$.meta={selector:"[minlength][formControl],[minlength][formControlName]",inputs:["minlength"],hosts:{host:c}};var q=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var e=n.prototype;return e.onInit=function(){this.validator=w(this.min);this.host.control.addValidators(this.validator)},e.onChanges=function(t){this.validator.params={min:this.min}},n}(n.Directive);q.meta={selector:"[min][formControl],[min][formControlName]",inputs:["min"],hosts:{host:c}};var I=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var e=n.prototype;return e.onInit=function(){this.validator=D(this.pattern);this.host.control.addValidators(this.validator)},e.onChanges=function(t){this.validator.params={pattern:this.pattern}},n}(n.Directive);I.meta={selector:"[pattern][formControl],[pattern][formControlName]",inputs:["pattern"],hosts:{host:c}};var B=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n.prototype.onInit=function(){var t=this.validator=V();this.host.control.addValidators(t)},n}(n.Directive);B.meta={selector:"[requiredTrue][formControl],[requiredTrue][formControlName]",inputs:["requiredTrue"],hosts:{host:c}};var M=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n.prototype.onInit=function(){var t=this.validator=x();this.host.control.addValidators(t)},n}(n.Directive);M.meta={selector:"[required][formControl],[required][formControlName]",inputs:["required"],hosts:{host:c}};var O=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n}(n.Module),R=[l,f,d,m,p,v,g,y,b,A,L,E,q,$,I,M,B],P=[];O.meta={declarations:[].concat(R,P),exports:[].concat(R,P)};var G=function(){function t(t){this.validators=t?Array.isArray(t)?t:[t]:[]}var n=t.prototype;return n.initSubjects_=function(){this.valueSubject=new e.BehaviorSubject(null),this.statusSubject=new e.BehaviorSubject(this),this.validatorsSubject=(new e.BehaviorSubject).pipe(i.switchAll()),this.switchValidators_()},n.switchValidators_=function(){var t=this.validators.map((function(t){return t.params$})),n=t.length?e.combineLatest(t):e.of(t);this.validatorsSubject.next(n)},n.initObservables_=function(){var t=this;this.value$=this.valueSubject.pipe(i.distinctUntilChanged(),i.skip(1),i.tap((function(){t.submitted_=!1,t.dirty_=!0,t.statusSubject.next(t)})),i.shareReplay(1)),this.status$=e.merge(this.statusSubject,this.validatorsSubject).pipe(i.switchMap((function(){return t.validate$(t.value)})),i.shareReplay(1)),this.changes$=e.merge(this.value$,this.status$).pipe(i.map((function(){return t.value})),i.auditTime(1),i.shareReplay(1))},n.validate$=function(t){var n=this;return this.status===a.Disabled||this.status===a.Hidden||this.submitted_||!this.validators.length?(this.errors={},this.status===a.Invalid&&(this.status=a.Valid),e.of(this.errors)):e.combineLatest(this.validators.map((function(n){var i=n.validate(t);return e.isObservable(i)?i:e.of(i)}))).pipe(i.map((function(t){n.errors=Object.assign.apply(Object,[{}].concat(t)),n.status=0===Object.keys(n.errors).length?a.Valid:a.Invalid})))},n.reset=function(){this.status=a.Pending,this.value_=null,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(this)},n.patch=function(t){this.value_=t,this.dirty_=!0,this.submitted_=!1,this.statusSubject.next(this)},n.addValidators=function(){var t;(t=this.validators).push.apply(t,arguments),this.switchValidators_()},n.replaceValidators=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.validators=n,this.switchValidators_()},n.clearValidators=function(){this.validators=[],this.switchValidators_()},o(t,[{key:"pending",get:function(){return this.status===a.Pending}},{key:"valid",get:function(){return this.status!==a.Invalid}},{key:"invalid",get:function(){return this.status===a.Invalid}},{key:"disabled",get:function(){return this.status===a.Disabled},set:function(t){t?this.status!==a.Disabled&&(this.status=a.Disabled,this.statusSubject.next(this)):this.status===a.Disabled&&this.reset()}},{key:"enabled",get:function(){return this.status!==a.Disabled}},{key:"hidden",get:function(){return this.status===a.Hidden},set:function(t){t?this.status!==a.Hidden&&(this.status=a.Hidden,console.log("set hidden",t,this.status),this.statusSubject.next(this)):this.status===a.Hidden&&this.reset()}},{key:"visible",get:function(){return this.status!==a.Hidden}},{key:"submitted",get:function(){return this.submitted_},set:function(t){this.submitted_=t,this.statusSubject.next(this)}},{key:"dirty",get:function(){return this.dirty_}},{key:"pristine",get:function(){return!this.dirty_}},{key:"touched",get:function(){return this.touched_},set:function(t){this.touched_=t,this.statusSubject.next(this)}},{key:"untouched",get:function(){return!this.touched_}},{key:"value",get:function(){return this.value_},set:function(t){this.value_=t,this.valueSubject.next(t)}}]),t}(),z=function(t){function n(n,e){var i;return void 0===n&&(n=null),(i=t.call(this,e)||this).value_=n,i.status=a.Pending,i.errors={},i.initSubjects_(),i.initObservables_(),i.statusSubject.next(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}return s(n,t),n}(G),H=function(t){function n(n,e){var i;return(i=t.call(this,e)||this).controls=n,i.initControls_(n),i.initSubjects_(),i.initObservables_(),i}s(n,t);var r=n.prototype;return r.initControl_=function(t,n){var e;return(e=t=t instanceof G?t:new z(t)).addValidators.apply(e,this.validators),t.name=n,t},r.initControls_=function(t){var n=this;return this.forEach_((function(t,e){n.init(t,e)})),t},r.initSubjects_=function(){this.changesChildren=(new e.BehaviorSubject).pipe(i.switchAll()),this.switchSubjects_()},r.switchSubjects_=function(){var t=this.reduce_((function(t,n){return t.push(n.changes$),t}),[]),n=t.length?e.combineLatest(t):e.of(t);this.changesChildren.next(n)},r.initObservables_=function(){var t=this;this.changes$=this.changesChildren.pipe(i.map((function(){return t.value})),i.shareReplay(1))},r.validate=function(t){if(this.status===a.Disabled||this.status===a.Hidden)this.errors=[];else{var n=this.validators.map((function(n){return n(t)})).filter((function(t){return null!==t}));this.errors=this.reduce_((function(t,n){return t.concat(n.errors)}),n),this.status=0===this.errors.length?a.Valid:a.Invalid}return this.errors},r.forEach_=function(t){var n=this;Object.keys(this.controls).forEach((function(e){return t(n.controls[e],e)}))},r.reduce_=function(t,n){return this.forEach_((function(e,i){n=t(n,e,i)})),n},r.all_=function(t,n){return this.reduce_((function(e,i){return e&&i[t]===n}),!0)},r.any_=function(t,n){return this.reduce_((function(e,i){return e||i[t]===n}),!1)},r.reset=function(){this.forEach_((function(t){return t.reset()}))},r.patch=function(t){t&&this.forEach_((function(n,e){n.patch(t[e])}))},r.init=function(t,n){this.controls[n]=this.initControl_(t,n)},r.get=function(t){return this.controls[t]},r.set=function(t,n){delete this.controls[n],this.controls[n]=this.initControl_(t,n),this.switchSubjects_()},r.add=function(t,n){this.controls[n]=this.initControl_(t,n),this.switchSubjects_()},r.remove=function(t){var n=this,e=Object.keys(this.controls).find((function(e){return n.controls[e]===t?e:null}));e&&this.removeKey(e)},r.removeKey=function(t){var n=void 0!==this.controls[t];delete this.controls[t],n&&this.switchSubjects_()},r.addValidators=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.forEach_((function(t){return t.addValidators.apply(t,n)}))},r.replaceValidators=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.forEach_((function(t){return t.replaceValidators.apply(t,n)}))},r.clearValidators=function(){this.forEach_((function(t){return t.clearValidators()}))},o(n,[{key:"valid",get:function(){return this.all_("valid",!0)}},{key:"invalid",get:function(){return this.any_("invalid",!0)}},{key:"pending",get:function(){return this.any_("pending",!0)}},{key:"disabled",get:function(){return this.all_("disabled",!0)},set:function(t){this.forEach_((function(n){n.disabled=t}))}},{key:"enabled",get:function(){return this.any_("enabled",!0)}},{key:"hidden",get:function(){return this.all_("hidden",!0)},set:function(t){this.forEach_((function(n){n.hidden=t}))}},{key:"visible",get:function(){return this.any_("visible",!0)}},{key:"submitted",get:function(){return this.all_("submitted",!0)},set:function(t){this.forEach_((function(n){n.submitted=t}))}},{key:"dirty",get:function(){return this.any_("dirty",!0)}},{key:"pristine",get:function(){return this.all_("pristine",!0)}},{key:"touched",get:function(){return this.all_("touched",!0)},set:function(t){this.forEach_((function(n){n.touched=t}))}},{key:"untouched",get:function(){return this.any_("untouched",!0)}},{key:"value",get:function(){return this.reduce_((function(t,n,e){return t[e]=n.value,t}),{})},set:function(t){this.forEach_((function(n,e){n.value=t[e]}))}},{key:"errors",get:function(){return this.reduce_((function(t,n){return Object.assign(t,n.errors)}),{})}}]),n}(G),Z=function(t){function n(n,e){return void 0===n&&(n=[]),t.call(this,n,e)||this}s(n,t);var e=n.prototype;return e.forEach_=function(t){this.controls.forEach((function(n,e){return t(n,e)}))},e.init=function(t,n){this.controls.length=Math.max(this.controls.length,n),this.controls[n]=this.initControl_(t,n)},e.set=function(t,n){this.controls.splice(n,1,this.initControl_(t,n)),this.switchSubjects_()},e.add=function(t,n){this.controls.length=Math.max(this.controls.length,n),this.controls[n]=this.initControl_(t,n),this.switchSubjects_()},e.push=function(t){this.controls.push(this.initControl_(t,this.controls.length)),this.switchSubjects_()},e.insert=function(t,n){this.controls.splice(n,0,this.initControl_(t,n)),this.switchSubjects_()},e.remove=function(t){var n=this.controls.indexOf(t);-1!==n&&this.removeKey(n)},e.removeKey=function(t){this.controls.length>t&&(this.controls.splice(t,1),this.switchSubjects_())},e.at=function(t){return this.controls[t]},o(n,[{key:"value",get:function(){return this.reduce_((function(t,n,e){return t[e]=n.value,t}),[])}},{key:"length",get:function(){return this.controls.length}}]),n}(H);var T=function(t){function n(n,e){return void 0===n&&(n={}),t.call(this,n,e)||this}return s(n,t),n}(H);t.EmailValidator=N,t.FormAbstract=G,t.FormAbstractCollection=H,t.FormAbstractCollectionDirective=h,t.FormArray=Z,t.FormArrayDirective=l,t.FormAttributes=u,t.FormCheckboxDirective=f,t.FormControl=z,t.FormEmailDirective=A,t.FormFieldComponent=d,t.FormGroup=T,t.FormGroupDirective=m,t.FormInputDirective=p,t.FormMaxDirective=L,t.FormMaxLengthDirective=E,t.FormMinDirective=q,t.FormMinLengthDirective=$,t.FormModule=O,t.FormPatternDirective=I,t.FormPlaceholderDirective=v,t.FormRadioDirective=g,t.FormRequiredDirective=M,t.FormRequiredTrueDirective=B,t.FormSelectDirective=y,t.FormStatus=a,t.FormValidator=C,t.MaxLengthValidator=S,t.MaxValidator=j,t.MinLengthValidator=k,t.MinValidator=w,t.NullValidator=_,t.PatternValidator=D,t.RequiredTrueValidator=V,t.RequiredValidator=x,t.Validators=F,t.formArray=function(t,n){return new Z(t,n)},t.formGroup=function(t,n){return new T(t,n)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=rxcomp-form.min.js.map